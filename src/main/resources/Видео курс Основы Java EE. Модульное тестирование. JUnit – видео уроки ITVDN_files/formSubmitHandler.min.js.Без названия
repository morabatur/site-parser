function validateForm(t) { function e() { var e = $('<div class="error-text">'), a = t.data("bottom-position"); return a && e.css({ bottom: a }), e } function a(t) { return t.hasClass("intl-phone-input") } function n(t) { var e = t.intlTelInput("getNumber"), a = t.closest(".intl-tel-input").siblings('input[name="Phone"]'); a.val(e), console.log(a.val()) } var i = !0, r = t.find('input[type="text"], input[type="email"], input[type="tel"], input[type="number"], input[type="password"], textarea'), p = t.find('input[type="file"]'); if (0 != p.length) var d = t.find('input[type="file"]')[0].files[0]; if (r.each(function () { var t = $(this), r = t.closest(".input-container"); console.log(r), r.children(".error-text").empty(); var p = e(); if (t.val()) { if (t.data("pattern")) { var d = new RegExp(t.data("pattern")); t.val().match(d) ? (p.empty().fadeOut(), t.removeClass("invalid-input"), a(t) && n(t)) : (i = !1, p.text("Введено некорректное значение").appendTo(r).fadeIn(), t.addClass("invalid-input")) } } else t.data("required") && (i = !1, p.text("Поле является обязательным").appendTo(r).fadeIn(), t.addClass("invalid-input")) }), d) { var s = $(".user-photo").siblings(".error-text"); d.type.match(/^image\/(gif|png|jpeg|jpg)$/) ? d.size / 1024 / 1024 > 1 ? (i = !1, s.text("Размер изображения не может превышать 1МБ").fadeIn()) : s.empty().fadeOut() : (i = !1, s.text("Не правильный формат изображения").fadeIn()) } var l = t.find('input[type="password"]'); if (l.length > 1) { var o = t.find('input[type="password"]#new-password'), u = t.find('input[type="password"]#confirm-password'), s = e(), f = u.parent(".input-container"); o.val() !== u.val() ? (i = !1, s.text("Пароли не совпадают").appendTo(f).fadeIn(), u.addClass("invalid-input")) : (s.empty().fadeOut(), u.removeClass("invalid-input")) } return i } function formSubmitHandler(t) { t.preventDefault(); var e = $(this)[0], a = $(this), n = validateForm($(this)), i = $(this).data("url"), r = $(this).data("success-text") || "Изменения успешно сохранены"; if ($(e).find('*[type="submit"]').attr("disabled", !0), $(e).find(".form-preloader").show(), n) { var p = new FormData(e); console.log(p), $.ajax({ type: "POST", url: i, processData: !1, contentType: !1, data: p }).then(function (t) { if ($(e).find('*[type="submit"]').attr("disabled", !1), $(e).find(".form-preloader").hide(), t && t.isServerValid !== !1) { a.find(".result-popup"); a.find(".result-popup").text(r).fadeIn().delay(3e3).fadeOut(), a.data("noautoclear") || a.trigger("reset") } else { var n = t.message || "Что-то пошло не так"; a.find(".result-popup").text(n).fadeIn().delay(3e3).fadeOut() } }) } else $(e).find('*[type="submit"]').attr("disabled", !1), $(e).find(".form-preloader").hide() }
